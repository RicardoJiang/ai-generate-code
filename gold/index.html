<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»„é‡‘å®šæŠ•æ”¶ç›Šåˆ†ææŠ¥å‘Š (å«å½“å¹´æ”¶ç›Šç‡)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8fafc; color: #334155; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin: 0 auto; height: 350px; max-height: 400px; }
        .stat-card { transition: transform 0.2s, box-shadow 0.2s; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .year-row:hover { background-color: #f1f5f9; }
        .highlight-2025 { background-color: #fffbeb; border-left: 3px solid #f59e0b; }
        .tooltip-indicator { cursor: help; border-bottom: 1px dotted #94a3b8; }
    </style>
    <!-- Chosen Palette: Slate & Gold. Background: #f8fafc. Primary: #d97706. Added Blue column for Yearly Return. -->
    <!-- Application Structure Plan: 
         1. Simulation Logic Update: Implemented 'Modified Dietz' method to calculate calculating specific yearly performance isolated from the total history.
         2. Table Layout: Added "å½“å¹´æ”¶ç›Šç‡" column.
         3. 2025 Data: Retained the "Boom Scenario" ($4480) to show the massive impact on the final year's specific return.
    -->
    <!-- Visualization & Content Choices:
         - Added a specific column for "Yearly Return" to distinguish from "Total Cumulative ROI".
         - Yearly Return = (EndValue - StartValue - NetFlow) / (StartValue + NetFlow/2).
         - Color coded (Red/Green) to emphasize volatility.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Navbar / Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <span class="text-2xl text-amber-500 font-bold">â—</span>
                <h1 class="text-xl font-bold tracking-tight text-slate-900">é»„é‡‘å®šæŠ• 14 å¹´å¤ç›˜ <span class="text-xs font-normal text-slate-500 ml-2 border border-slate-200 px-2 py-0.5 rounded">å«å•å¹´æ”¶ç›Šè¯¦æƒ…</span></h1>
            </div>
            <div class="text-sm text-slate-500 hidden sm:block">
                æ•°æ®å‘¨æœŸ: 2012.01 - 2025.12
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-10">

        <!-- Introduction & Inputs -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
            <div class="lg:col-span-2 space-y-4">
                <h2 class="text-3xl font-bold text-slate-900">å®šæŠ•çš„çœŸç›¸ï¼šæ³¢åŠ¨å³æˆæœ¬</h2>
                <p class="text-lg text-slate-600 leading-relaxed">
                    æœ¬æŠ¥å‘Šæ¨¡æ‹Ÿäº† <strong>2012-2025</strong> å¹´é—´çš„é»„é‡‘å®šæŠ•è¡¨ç°ã€‚
                    <br><br>
                    <span class="inline-block bg-blue-50 text-blue-800 text-sm font-semibold px-2 py-1 rounded border border-blue-100 mb-2">æ–°å¢æ•°æ®åˆ—è¯´æ˜</span>
                    <br>
                    ä¸‹æ–¹è¡¨æ ¼ç°å·²åŒ…å« <strong>â€œå½“å¹´æ”¶ç›Šç‡â€</strong>ã€‚è¯¥æŒ‡æ ‡è¡¡é‡çš„æ˜¯è´¦æˆ·åœ¨<strong>è¿™å…·ä½“çš„ä¸€å¹´é‡Œ</strong>çš„è¡¨ç°ï¼Œä¸å†å²ç§¯ç´¯æ— å…³ã€‚é€šè¿‡è§‚å¯Ÿè¿™ä¸€åˆ—ï¼Œæ‚¨ä¼šå‘ç°å®šæŠ•å¹¶éæ¯å¹´éƒ½èµšé’±â€”â€”åœ¨ 2013ã€2015 ç­‰å¹´ä»½ï¼Œæ‚¨çš„å¹´åº¦è´¦æˆ·å…¶å®æ˜¯äºæŸçš„ï¼Œä½†æ­£æ˜¯è¿™äº›â€œäºæŸå¹´â€ç§¯ç´¯çš„ä½ä»·ç­¹ç ï¼Œé€ å°±äº† 2025 å¹´çš„çˆ†å‘ã€‚
                </p>
            </div>
            
            <!-- Interactive Control Panel -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <label for="monthlyInput" class="block text-sm font-medium text-slate-700 mb-2">æ¯æœˆå®šæŠ•é‡‘é¢ (USD)</label>
                <div class="relative rounded-md shadow-sm">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                        <span class="text-slate-500 sm:text-sm">$</span>
                    </div>
                    <input type="number" id="monthlyInput" name="monthlyInput" value="200" 
                           class="block w-full rounded-md border-slate-300 pl-7 pr-12 py-3 text-lg focus:border-amber-500 focus:ring-amber-500 sm:text-sm border outline-none transition-colors" 
                           placeholder="200">
                </div>
                <p class="mt-2 text-xs text-slate-500">è°ƒæ•´æŠ•å…¥é‡‘é¢ï¼ŒæŸ¥çœ‹æ”¶ç›Šå˜åŒ–ã€‚</p>
            </div>
        </section>

        <!-- KPI Dashboard -->
        <section id="kpi-section" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Cards will be injected by JS -->
        </section>

        <!-- Chart Section 1: Portfolio Growth -->
        <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <div class="mb-6">
                <h3 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                    <span class="w-1 h-6 bg-amber-500 rounded-full"></span>
                    èµ„äº§å¢é•¿æ›²çº¿ (2025 Jå‹çˆ†å‘)
                </h3>
                <p class="text-slate-500 mt-2">
                    2025 å¹´çš„ç›´çº¿æ‹‰å‡ï¼Œæ˜¯ 14 å¹´å®šæŠ•é•¿è·‘çš„ç»ˆç‚¹å†²åˆºã€‚
                </p>
            </div>
            <div class="chart-container">
                <canvas id="growthChart"></canvas>
            </div>
        </section>

        <!-- Chart Section 2: Annual Performance -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                        <span class="w-1 h-6 bg-blue-500 rounded-full"></span>
                        å†å¹´â€œå•å¹´â€æ”¶ç›Šç‡
                    </h3>
                    <p class="text-slate-500 mt-2">
                        è¿™é‡Œå±•ç¤ºçš„æ˜¯<strong>æ¯ä¸€å¹´ç‹¬ç«‹çš„è¡¨ç°</strong>ï¼ˆè€Œéç´¯è®¡ï¼‰ã€‚å¯ä»¥æ¸…æ™°çœ‹åˆ°å¸‚åœºçš„å†·æš–äº¤æ›¿ï¼š2013 å¹´çš„å¤§è·Œä¸ 2025 å¹´çš„å¤§æ¶¨ã€‚
                    </p>
                </div>
                <div class="chart-container">
                    <canvas id="annualReturnChart"></canvas>
                </div>
            </div>

            <!-- Contextual Insight Sidebar -->
            <div class="bg-slate-100 p-6 rounded-xl border border-slate-200 flex flex-col justify-center space-y-6">
                <div>
                    <h4 class="font-bold text-slate-900 mb-2">ğŸ“Š ç´¯è®¡ vs å•å¹´</h4>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        æ³¨æ„åŒºåˆ†è¡¨æ ¼ä¸­çš„ä¸¤ä¸ªæ”¶ç›Šç‡ï¼š
                        <br>â€¢ <strong>å½“å¹´æ”¶ç›Šç‡</strong>ï¼šè¿™ä¸€å¹´æˆ‘èµšäº†å¤šå°‘ï¼Ÿ(åæ˜ çŸ­æœŸæ³¢åŠ¨)
                        <br>â€¢ <strong>æ€»æ”¶ç›Šç‡</strong>ï¼šä»2012å¹´åˆ°ç°åœ¨æˆ‘æ€»å…±èµšäº†å¤šå°‘ï¼Ÿ(åæ˜ é•¿æœŸç§¯ç´¯)
                    </p>
                </div>
                <div>
                    <h4 class="font-bold text-slate-900 mb-2">ğŸ“‰ å¿å—å›æ’¤</h4>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        æ•°æ®è¡¨æ˜ï¼Œåœ¨ 2013 å¹´ï¼Œæ‚¨çš„è´¦æˆ·ä¸€å¹´å†…ç¼©æ°´äº†è¿‘ 30%ã€‚è¿™æ˜¯å¯¹å®šæŠ•ä¿¡ä»°çš„æœ€å¤§è€ƒéªŒã€‚
                    </p>
                </div>
            </div>
        </section>

        <!-- Detailed Data Table -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 border-b border-slate-100 flex flex-col sm:flex-row justify-between sm:items-center gap-4">
                <div>
                    <h3 class="text-xl font-bold text-slate-900">å†å¹´è¯¦ç»†æ•°æ®è¡¨</h3>
                    <p class="text-sm text-slate-500 mt-1">2025 æ•°æ®é«˜äº®æ˜¾ç¤º</p>
                </div>
                <div class="flex gap-2 text-xs">
                    <span class="flex items-center gap-1"><span class="w-3 h-3 bg-blue-100 border border-blue-200 block"></span> å•å¹´è¡¨ç°</span>
                    <span class="flex items-center gap-1"><span class="w-3 h-3 bg-purple-100 border border-purple-200 block"></span> é•¿æœŸå¹´åŒ–</span>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm whitespace-nowrap">
                    <thead class="bg-slate-50 text-slate-500 uppercase tracking-wider font-semibold">
                        <tr>
                            <th class="px-4 py-4 sticky left-0 bg-slate-50 drop-shadow-sm z-10">å¹´ä»½</th>
                            <th class="px-4 py-4">å½“å¹´æŠ•å…¥</th>
                            <th class="px-4 py-4">å¹´æœ«é‡‘ä»·</th>
                            <th class="px-4 py-4">å¹´æœ«æ€»å¸‚å€¼</th>
                            <th class="px-4 py-4 text-right bg-blue-50/50 text-blue-800" title="è¯¥å¹´åº¦è´¦æˆ·èµ„é‡‘çš„å¢å€¼æ¯”ä¾‹">å½“å¹´æ”¶ç›Šç‡</th>
                            <th class="px-4 py-4 text-right">ç´¯è®¡æ€»æ”¶ç›Šç‡</th>
                            <th class="px-4 py-4 text-right bg-purple-50/50 text-purple-800">å¹´åŒ–å›æŠ¥ (IRR)</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="divide-y divide-slate-100 text-slate-700">
                        <!-- Rows injected by JS -->
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <footer class="bg-slate-900 text-slate-400 py-12 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-2">æœ¬æŠ¥å‘ŠåŸºäºå†å²åŠ 2025 å¹´æ¨¡æ‹Ÿå¸‚åœºæ•°æ®ã€‚</p>
            <p class="text-xs text-slate-600">Generated by Canvas Create Webapp â€¢ Data Source: Simulated Historical Spot Gold (XAU/USD)</p>
        </div>
    </footer>

    <script>
        // --- Data & State Management ---

        // Historical year-end prices (Approximate close prices XAU/USD)
        const yearEndPrices = {
            2011: 1560, 
            2012: 1675,
            2013: 1205,
            2014: 1184,
            2015: 1060,
            2016: 1150,
            2017: 1300,
            2018: 1280,
            2019: 1515,
            2020: 1895,
            2021: 1820,
            2022: 1824,
            2023: 2062,
            2024: 2650,
            2025: 4480 // 2025 Boom Scenario
        };

        let monthlyInvestment = 200;
        let simulationData = [];
        let yearlySummary = [];
        
        let growthChartInstance = null;
        let annualReturnChartInstance = null;

        // --- Core Logic: Calculation Utilities ---

        function calculateDCA_IRR(months, monthlyPayment, finalValue) {
            if (finalValue <= 0) return -100;
            if (Math.abs(monthlyPayment * months - finalValue) < 1) return 0;

            let low = -0.9; 
            let high = 1.0; 
            let guess = 0;
            let calculatedFV = 0;

            for (let i = 0; i < 100; i++) {
                guess = (low + high) / 2;
                if (guess === 0) {
                    calculatedFV = monthlyPayment * months;
                } else {
                    calculatedFV = monthlyPayment * ((Math.pow(1 + guess, months) - 1) / guess) * (1 + guess);
                }

                if (Math.abs(calculatedFV - finalValue) < 0.1) break;

                if (calculatedFV > finalValue) high = guess;
                else low = guess;
            }

            return (Math.pow(1 + guess, 12) - 1) * 100;
        }

        // --- Core Logic: Simulation ---

        function generateMonthlyData() {
            const data = [];
            const years = Object.keys(yearEndPrices).filter(y => y >= 2012);
            
            years.forEach((year, index) => {
                const prevPrice = yearEndPrices[year - 1];
                const endPrice = yearEndPrices[year];
                const priceDiff = endPrice - prevPrice;
                
                for (let m = 1; m <= 12; m++) {
                    const progress = m / 12;
                    let simulatedPrice = prevPrice + (priceDiff * progress);
                    simulatedPrice = simulatedPrice * (1 + (Math.random() * 0.04 - 0.02)); 
                    
                    data.push({
                        year: parseInt(year),
                        month: m,
                        dateLabel: `${year}-${String(m).padStart(2, '0')}`,
                        price: simulatedPrice
                    });
                }
            });
            return data;
        }

        function runSimulation() {
            const rawData = generateMonthlyData();
            let totalUnits = 0;
            let totalInvested = 0;
            let monthsPassed = 0;
            
            // To calculate yearly return, we need the Portfolio Value at the END of the Previous Year
            let prevYearValue = 0;

            yearlySummary = [];
            
            simulationData = rawData.map((d, index) => {
                monthsPassed++;
                const unitsBought = monthlyInvestment / d.price;
                totalUnits += unitsBought;
                totalInvested += monthlyInvestment;
                
                const currentValue = totalUnits * d.price;
                const roi = ((currentValue - totalInvested) / totalInvested) * 100;
                
                if (d.month === 12) {
                    const irr = calculateDCA_IRR(monthsPassed, monthlyInvestment, currentValue);
                    
                    // --- Calculate Specific Year Return (Modified Dietz) ---
                    // Formula: (EndVal - StartVal - CashFlow) / (StartVal + CashFlow/2)
                    const investedThisYear = monthlyInvestment * 12;
                    const gainThisYear = currentValue - prevYearValue - investedThisYear;
                    const averageCapital = prevYearValue + (investedThisYear / 2);
                    
                    // Avoid division by zero for the very first split second
                    let specificYearReturn = 0;
                    if (averageCapital > 0) {
                        specificYearReturn = (gainThisYear / averageCapital) * 100;
                    }

                    yearlySummary.push({
                        year: d.year,
                        investedThisYear: investedThisYear,
                        totalInvested: totalInvested,
                        totalUnits: totalUnits,
                        endPrice: d.price,
                        totalValue: currentValue,
                        totalROI: roi,
                        annualizedIRR: irr,
                        specificYearReturn: specificYearReturn
                    });

                    // Update prevYearValue for the next loop
                    prevYearValue = currentValue;
                }

                return {
                    ...d,
                    totalInvested,
                    totalUnits,
                    portfolioValue: currentValue,
                    roi
                };
            });
        }

        // --- UI Update Functions ---

        function updateKPICards() {
            const lastPoint = yearlySummary[yearlySummary.length - 1];
            const profit = lastPoint.totalValue - lastPoint.totalInvested;
            const isPositive = profit >= 0;

            const cards = [
                {
                    label: "14 å¹´ç´¯è®¡æŠ•å…¥",
                    value: `$${lastPoint.totalInvested.toLocaleString()}`,
                    sub: "æœ¬é‡‘ (Principal)",
                    color: "text-slate-900",
                    border: "border-l-4 border-slate-400"
                },
                {
                    label: "2025 å¹´æœ«æ€»å¸‚å€¼",
                    value: `$${Math.round(lastPoint.totalValue).toLocaleString()}`,
                    sub: `${lastPoint.totalUnits.toFixed(2)} ç›å¸ (@ $${lastPoint.endPrice.toFixed(0)})`,
                    color: "text-amber-600",
                    border: "border-l-4 border-amber-500"
                },
                {
                    label: "ç´¯è®¡æ€»æ”¶ç›Šç‡ (ROI)",
                    value: `${isPositive ? '+' : ''}${lastPoint.totalROI.toFixed(1)}%`,
                    sub: `å‡€èµš: $${Math.round(profit).toLocaleString()}`,
                    color: isPositive ? "text-emerald-600" : "text-red-600",
                    border: isPositive ? "border-l-4 border-emerald-500" : "border-l-4 border-red-500"
                },
                {
                    label: "å¹´åŒ–æ”¶ç›Šç‡ (IRR)",
                    value: `${lastPoint.annualizedIRR.toFixed(2)}%`,
                    sub: "èµ„é‡‘åˆ©ç”¨æ•ˆç‡",
                    color: "text-purple-600",
                    border: "border-l-4 border-purple-500"
                }
            ];

            const container = document.getElementById('kpi-section');
            container.innerHTML = cards.map(card => `
                <div class="stat-card bg-white p-5 rounded-lg shadow-sm border border-slate-100 ${card.border}">
                    <p class="text-xs font-semibold text-slate-500 uppercase tracking-wide flex justify-between">
                        ${card.label}
                    </p>
                    <p class="text-2xl font-bold mt-2 ${card.color}">${card.value}</p>
                    <p class="text-xs text-slate-400 mt-2">${card.sub}</p>
                </div>
            `).join('');
        }

        function updateTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = yearlySummary.map(row => {
                const totalRoiClass = row.totalROI >= 0 ? 'text-emerald-600 font-medium' : 'text-red-500 font-medium';
                const irrClass = row.annualizedIRR >= 0 ? 'text-purple-700 font-bold' : 'text-red-500 font-bold';
                
                // Color logic for Specific Year Return
                const yearRetClass = row.specificYearReturn >= 0 ? 'text-blue-700 font-bold' : 'text-red-500 font-bold';
                
                const is2025 = row.year === 2025 ? 'highlight-2025' : '';
                
                return `
                    <tr class="year-row transition-colors border-b border-slate-50 last:border-0 ${is2025}">
                        <td class="px-4 py-4 font-medium text-slate-900 sticky left-0 ${is2025 ? 'bg-[#fffbeb]' : 'bg-white'} drop-shadow-sm flex items-center gap-2">
                            ${row.year}
                            ${row.year === 2025 ? '<span class="text-[10px] bg-red-100 text-red-600 px-1 rounded">HOT</span>' : ''}
                        </td>
                        <td class="px-4 py-4 text-slate-500">$${row.investedThisYear.toLocaleString()}</td>
                        <td class="px-4 py-4 font-mono text-xs text-slate-400">$${row.endPrice.toFixed(0)}</td>
                        <td class="px-4 py-4 font-bold text-slate-800">$${Math.round(row.totalValue).toLocaleString()}</td>
                        
                        <!-- Specific Year Return Column -->
                        <td class="px-4 py-4 text-right bg-blue-50/50 ${yearRetClass}">
                            ${row.specificYearReturn > 0 ? '+' : ''}${row.specificYearReturn.toFixed(1)}%
                        </td>
                        
                        <td class="px-4 py-4 text-right ${totalRoiClass}">${row.totalROI > 0 ? '+' : ''}${row.totalROI.toFixed(1)}%</td>
                        <td class="px-4 py-4 text-right bg-purple-50/50 ${irrClass}">${row.annualizedIRR.toFixed(2)}%</td>
                    </tr>
                `;
            }).join('');
        }

        function renderCharts() {
            const ctxGrowth = document.getElementById('growthChart').getContext('2d');
            const ctxReturn = document.getElementById('annualReturnChart').getContext('2d');

            // 1. Growth Chart
            const labels = simulationData.filter((d, i) => i % 6 === 0).map(d => d.dateLabel);
            const dataInvested = simulationData.filter((d, i) => i % 6 === 0).map(d => d.totalInvested);
            const dataValue = simulationData.filter((d, i) => i % 6 === 0).map(d => d.portfolioValue);

            if (growthChartInstance) growthChartInstance.destroy();

            growthChartInstance = new Chart(ctxGrowth, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ç´¯è®¡æŠ•å…¥ (æœ¬é‡‘)',
                            data: dataInvested,
                            borderColor: '#94a3b8',
                            backgroundColor: 'rgba(148, 163, 184, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'æŒä»“å¸‚å€¼ (èµ„äº§)',
                            data: dataValue,
                            borderColor: '#d97706',
                            backgroundColor: 'rgba(217, 119, 6, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { position: 'top', align: 'end' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + Math.round(context.raw).toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: { borderDash: [2, 4], color: '#f1f5f9' },
                            ticks: { callback: (val) => '$' + val }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { maxRotation: 0, autoSkip: true, maxTicksLimit: 14 }
                        }
                    }
                }
            });

            // 2. Yearly Return Chart (Changed to show Specific Year Return based on user request)
            const years = yearlySummary.map(y => y.year);
            // NOW SHOWING: Specific Year Return in the bar chart to match the new column focus
            const yearRetData = yearlySummary.map(y => y.specificYearReturn);
            
            const barColors = yearRetData.map(val => val >= 0 ? '#3b82f6' : '#ef4444'); // Blue for positive year, Red for negative

            if (annualReturnChartInstance) annualReturnChartInstance.destroy();

            annualReturnChartInstance = new Chart(ctxReturn, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'å½“å¹´æ”¶ç›Šç‡ (%)',
                        data: yearRetData,
                        backgroundColor: barColors,
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `å½“å¹´æ”¶ç›Šç‡: ${ctx.raw.toFixed(1)}%`
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: '#f1f5f9' },
                            ticks: { callback: (val) => val + '%' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // --- Initialization ---

        function init() {
            runSimulation();
            updateKPICards();
            renderCharts();
            updateTable();

            const input = document.getElementById('monthlyInput');
            input.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                if (val && val > 0) {
                    monthlyInvestment = val;
                    runSimulation();
                    updateKPICards();
                    renderCharts();
                    updateTable();
                }
            });
        }

        window.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
